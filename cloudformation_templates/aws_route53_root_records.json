{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Additional DNS records that are needed on the root domain.",

  "Parameters": {
    "HostedZoneName": {
      "Type": "String",
      "Description": "Hosted zone name"
    }
  },

  "Resources": {
    "GoogleMailServers": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Ref": "HostedZoneName"},
        "Type": "MX",
        "ResourceRecords": [
          "30 ALT4.ASPMX.L.GOOGLE.COM.",
          "30 ALT3.ASPMX.L.GOOGLE.COM.",
          "20 ALT2.ASPMX.L.GOOGLE.COM.",
          "20 ALT1.ASPMX.L.GOOGLE.COM.",
          "10 ASPMX.L.GOOGLE.COM."
        ],
        "TTL": "3600"
      }
    },

    "MandrillDKIMRecord": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Fn::Join": ["", [
          "mandrill._domainkey", ".", {"Ref": "HostedZoneName"}
        ]]},
        "Type": "TXT",
        "ResourceRecords": [
          "\"v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCrLHiExVd55zd/IQ/J/mRwSRMAocV/hMB3jXwaHH36d9NaVynQFYV8NaWi69c1veUtRzGt7yAioXqLj7Z4TeEUoOLgrKsn8YnckGs9i3B3tVFB+Ch/4mPhXWiNfNdynHWBcPcbJ8kjEQ2U8y78dHZj1YeRXXVvWob2OaKynO8/lQIDAQAB;\""
        ],
        "TTL": "300"
      }
    },

    "MailchimpDKIMRecord": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Fn::Join": ["", [
          "k1._domainkey", ".", {"Ref": "HostedZoneName"}
        ]]},
        "Type": "CNAME",
        "ResourceRecords": [
          "dkim.mcsv.net"
        ],
        "TTL": "300"
      }
    },

    "ZendeskDKIMRecord": {
      "Type": "AWS::Route53::RecordSetGroup",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "RecordSets": [
          {
            "Name": {"Fn::Join": [".", [
              "zendesk1._domainkey", {"Ref": "HostedZoneName"}
            ]]},
            "Type" : "CNAME",
            "TTL" : "900",
            "ResourceRecords" : ["zendesk1._domainkey.zendesk.com"]
          },
          {
            "Name": {"Fn::Join": [".", [
              "zendesk2._domainkey", {"Ref": "HostedZoneName"}
            ]]},
            "Type" : "CNAME",
            "TTL" : "900",
            "ResourceRecords" : ["zendesk2._domainkey.zendesk.com"]
          }
        ]
      }
    },

    "GoogleDKIMRecord": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Fn::Join": ["", [
          "google._domainkey", ".", {"Ref": "HostedZoneName"}
        ]]},
        "Type": "TXT",
        "ResourceRecords": [
          "\"v=DKIM1; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3Wu3i6aNpaGGyUzkmtiyWCb+MfB1ezhpYt4iEHktjOQVk7zdKcJJGR4jZrdIZ7/2mgM1d1nXLmhthtHh5cQ3najni7Y2FFgLdvGsAt6dkV5guKYRBZO9fxafwWZG8lk/6ajBYQPjZBzE5rO8vzrq0XXLPPXWyGPTn028\" \"u41Dvv8Xp+YYNYSssfwhO7lrXyBhspH8yV+wumvx3Eagu4QAr96+SAyCUomGTE67l1eXjGF7Q9GCLPc/BTaiE7VkEVGr8TppCuptigean17xAAHK4jROrzHxFepMXiRe+/ddQ3Fz3KNW0Pu4wFH3lz81zQlKSlBcgUaTxOTB3wyhSvpW/wIDAQAB\""
        ],
        "TTL": "300"
      }
    },

    "DMARCRecord": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Fn::Join": [".", ["_dmarc", {"Ref": "HostedZoneName"}]]},
        "Type": "TXT",
        "ResourceRecords": [
          "\"v=DMARC1; p=none; rua=mailto:support+dmarc-reports@digitalmarketplace.service.gov.uk; fo=1\""
        ],
        "TTL": "300"
      }
    },

    "GoogleVerification": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Ref": "HostedZoneName"},
        "Type": "TXT",
        "ResourceRecords": [
          "\"google-site-verification=wCZPbaSgAFuIlzK2CpzwiOYwgCUJP_ZUOhHTYCGs7aQ\"",
          "\"v=spf1 include:_spf.google.com include:spf.mandrillapp.com include:mail.zendesk.com include:servers.mcsv.net ~all\""
        ],
        "TTL": "300"
      }
    },

    "Development": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Fn::Join": ["", [
          "development", ".", {"Ref": "HostedZoneName"}
        ]]},
        "Type": "NS",
        "ResourceRecords": [
          "ns-656.awsdns-18.net.",
          "ns-1989.awsdns-56.co.uk.",
          "ns-318.awsdns-39.com.",
          "ns-1117.awsdns-11.org."
        ],
        "TTL": "3600"
      }
    },

    "CI": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneName": {"Ref": "HostedZoneName"},
        "Name": {"Fn::Join": ["", [
          "beta", ".", {"Ref": "HostedZoneName"}
        ]]},
        "Type": "NS",
        "ResourceRecords": [
          "ns-895.awsdns-47.net.",
          "ns-1187.awsdns-20.org.",
          "ns-505.awsdns-63.com.",
          "ns-1661.awsdns-15.co.uk."
        ],
        "TTL": "3600"
      }
    }
  }
}
