{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Add ingress rule to security group",

  "Parameters": {
    "SecurityGroup": {
      "Type": "String",
      "Description": "Target security group name"
    },
    "CidrIPs": {
      "Type": "String",
      "Description": "List of CIDR IPs to use for security group rules"
    },
    "FromPort": {
      "Type": "Number",
      "Description": "FromPort to use for security group rules"
    },
    "ToPort": {
      "Type": "Number",
      "Description": "ToPort to use for security group rules"
    }
  },

  "Resources": {
{% for dev_ip in parameters.CidrIPs.split(',') %}
    "DeveloperIngress{{ loop.index }}": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupName": {"Ref": "SecurityGroup"},
        "IpProtocol": "tcp",
        "FromPort": {"Ref": "FromPort"},
        "ToPort": {"Ref": "ToPort"},
        "CidrIp": "{{ dev_ip }}"
      }
    }{% if not loop.last %},{% endif %}

{% endfor %}
  }
}
